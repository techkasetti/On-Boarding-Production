<!--
* chatFirstRegistration.html
* Main template with a wrapper div for centering and styling.
-->
<template>
    <!-- This new div is the wrapper for centering and sizing the component -->
    <div class="center-container">
        <lightning-card title="Chat First Registration">
            <div class="slds-p-around_medium">
                <!-- Chat transcript with new scroll container -->
                <div class="chat-container" data-id="chat-container">
                    <template for:each={messages} for:item="msg">
                        <div key={msg.id} class="message-row">
                            <p>
                                <strong>{msg.author}:</strong>
                                <span class="message-text"> {msg.text}</span>
                            </p>
                        </div>
                    </template>
                    <!-- Job Posting Cards will appear inside the scrollable chat window -->
                    <template if:true={jobPostings.length}>
                        <div class="slds-m-top_medium">
                            <template for:each={jobPostings} for:item="job">
                                <c-job-posting-card key={job.Id}
                                                    job-id={job.Id}
                                                    job-title={job.Name}
                                                    job-description={job.Description__c}
                                                    job-location={job.Location__c}
                                                    onselected={handleJobSelected}>
                                </c-job-posting-card>
                            </template>
                        </div>
                    </template>
                </div>
                <!-- File Uploader (conditionally rendered) -->
                <template if:true={canUpload}>
                    <div class="slds-p-around_medium">
                        <!-- CHANGED: Added record-id={candidateId} to link the upload to the candidate -->
                        <lightning-file-upload
                            label="Upload Resume"
                            record-id={candidateId}
                            onuploadfinished={handleUploadFinished}
                            multiple="false"
                            accept=".pdf,.doc,.docx">
                        </lightning-file-upload>
                    </div>
                </template>
                <!-- Resume Preview Panel (conditionally rendered)
                <template if:true={showPreview}>
                    <c-resume-preview-panel candidate-id={candidateId}
                                        onconfirmed={handleResumeConfirmed}
                                        oncancelled={handleResumeCancelled}>
                    </c-resume-preview-panel>
                </template> -->
                <!-- Resume Preview Panel (conditionally rendered) -->
<template if:true={showPreview}>
    <c-resume-preview-panel-v2
        candidate-id={candidateId}
        onconfirmed={handleResumeConfirmed}
        oncancelled={handleResumeCancelled}>
    </c-resume-preview-panel-v2>
</template>

                <!-- Chat input row -->
                <div class="slds-m-top_medium slds-grid slds-grid_align-spread">
                    <div class="slds-col slds-size_3-of-4">
                        <lightning-input
                            type="text"
                            label="Your message"
                            variant="label-hidden"
                            placeholder="Type your message..."
                            value={currentInput}
                            onchange={handleInputChange}
                            onkeydown={handleKeyDown}
                            disabled={isInputDisabled}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-4 slds-m-left_small">
                        <lightning-button variant="brand" label="Send" onclick={handleSend} disabled={isInputDisabled}></lightning-button>
                    </div>
                </div>
            </div>
        </lightning-card>
    </div>
</template>