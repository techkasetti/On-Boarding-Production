<!-- dynamicFormModal.html -->
<template>
    <template if:true={isOpen}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open" aria-modal="true">
            <div class="slds-modal__container" style="max-width: 600px;">
                <!-- Modal Header -->
                <header class="slds-modal__header slds-theme_shade" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <lightning-button-icon
                        icon-name="utility:close"
                        alternative-text="Close"
                        title="Close"
                        variant="bare-inverse"
                        class="slds-modal__close"
                        onclick={handleClose}
                    ></lightning-button-icon>
                    <h2 class="slds-text-heading_medium slds-hyphenate" style="color: white;">
                        <lightning-icon icon-name={modalIcon} size="small" class="slds-m-right_x-small" style="fill: white;"></lightning-icon>
                        {modalTitle}
                    </h2>
                </header>

                <!-- Modal Body -->
                <div class="slds-modal__content slds-p-around_medium" style="min-height: 300px;">
                    <template if:true={isLoading}>
                        <div class="slds-align_absolute-center slds-p-vertical_xx-large">
                            <lightning-spinner alternative-text="Saving..." size="medium" variant="brand"></lightning-spinner>
                            <p class="slds-m-top_small slds-text-color_weak">Saving your changes...</p>
                        </div>
                    </template>

                    <template if:false={isLoading}>
                        <div class="form-container">
                            <!-- Work Experience Fields -->
                            <template if:true={isWorkExperience}>
                                <div class="slds-form" role="list">
                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Job Title / Role"
                                            value={formData.Role__c}
                                            onchange={handleFieldChange}
                                            data-field="Role__c"
                                            required
                                            field-level-help="Your job title or role in the organization"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Company / Organization"
                                            value={formData.Organization__c}
                                            onchange={handleFieldChange}
                                            data-field="Organization__c"
                                            required
                                            field-level-help="Name of the company or organization"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Duration"
                                            value={formData.Duration_Text__c}
                                            onchange={handleFieldChange}
                                            data-field="Duration_Text__c"
                                            placeholder="e.g., Jan 2020 - Present"
                                            field-level-help="Time period of employment"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item" role="listitem">
                                        <lightning-textarea
                                            label="Responsibilities & Achievements"
                                            value={formData.Responsibilities__c}
                                            onchange={handleFieldChange}
                                            data-field="Responsibilities__c"
                                            rows="5"
                                            placeholder="Describe your key responsibilities and accomplishments..."
                                            field-level-help="Detail your main duties and notable achievements"
                                        ></lightning-textarea>
                                    </div>
                                </div>
                            </template>

                            <!-- Education Fields -->
                            <template if:true={isEducation}>
                                <div class="slds-form" role="list">
                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Institution / University"
                                            value={formData.Institution__c}
                                            onchange={handleFieldChange}
                                            data-field="Institution__c"
                                            required
                                            field-level-help="Name of the educational institution"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Degree / Qualification"
                                            value={formData.Degree__c}
                                            onchange={handleFieldChange}
                                            data-field="Degree__c"
                                            required
                                            placeholder="e.g., Bachelor of Science in Computer Science"
                                            field-level-help="Your degree or qualification earned"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Duration"
                                            value={formData.Duration_Text__c}
                                            onchange={handleFieldChange}
                                            data-field="Duration_Text__c"
                                            placeholder="e.g., 2016 - 2020"
                                            field-level-help="Years of study"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item" role="listitem">
                                        <lightning-textarea
                                            label="Details"
                                            value={formData.Details__c}
                                            onchange={handleFieldChange}
                                            data-field="Details__c"
                                            rows="4"
                                            placeholder="GPA, honors, activities, coursework..."
                                            field-level-help="Additional details about your education"
                                        ></lightning-textarea>
                                    </div>
                                </div>
                            </template>

                            <!-- License/Certification Fields -->
                            <template if:true={isLicense}>
                                <div class="slds-form" role="list">
                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Certification Name"
                                            value={formData.Name}
                                            onchange={handleFieldChange}
                                            data-field="Name"
                                            required
                                            placeholder="e.g., AWS Certified Solutions Architect"
                                            field-level-help="Name of the license or certification"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Type / Category"
                                            value={formData.Type__c}
                                            onchange={handleFieldChange}
                                            data-field="Type__c"
                                            placeholder="e.g., Professional License, Certification"
                                            field-level-help="Type or category of certification"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item" role="listitem">
                                        <lightning-textarea
                                            label="Notes"
                                            value={formData.Notes__c}
                                            onchange={handleFieldChange}
                                            data-field="Notes__c"
                                            rows="3"
                                            placeholder="Expiry date, issuing organization, credential ID..."
                                            field-level-help="Additional information about the certification"
                                        ></lightning-textarea>
                                    </div>
                                </div>
                            </template>

                            <!-- Clinical Skill Fields -->
                            <template if:true={isClinicalSkill}>
                                <div class="slds-form" role="list">
                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Skill Name"
                                            value={formData.Name}
                                            onchange={handleFieldChange}
                                            data-field="Name"
                                            required
                                            placeholder="e.g., Patient Assessment"
                                            field-level-help="Name of the clinical skill"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Skill Type"
                                            value={formData.Skill_Type__c}
                                            onchange={handleFieldChange}
                                            data-field="Skill_Type__c"
                                            placeholder="e.g., Diagnostic, Therapeutic"
                                            field-level-help="Category or type of skill"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item" role="listitem">
                                        <lightning-textarea
                                            label="Description"
                                            value={formData.Description__c}
                                            onchange={handleFieldChange}
                                            data-field="Description__c"
                                            rows="3"
                                            placeholder="Describe your proficiency and experience..."
                                            field-level-help="Details about your skill level and experience"
                                        ></lightning-textarea>
                                    </div>
                                </div>
                            </template>

                            <!-- Technical Skill Fields -->
                            <template if:true={isTechnicalSkill}>
                                <div class="slds-form" role="list">
                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Skill Name"
                                            value={formData.Name}
                                            onchange={handleFieldChange}
                                            data-field="Name"
                                            required
                                            placeholder="e.g., JavaScript, Python"
                                            field-level-help="Name of the technical skill"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item slds-m-bottom_medium" role="listitem">
                                        <lightning-input
                                            label="Category"
                                            value={formData.Category__c}
                                            onchange={handleFieldChange}
                                            data-field="Category__c"
                                            placeholder="e.g., Programming Language, Framework"
                                            field-level-help="Category of the technical skill"
                                        ></lightning-input>
                                    </div>

                                    <div class="slds-form__item" role="listitem">
                                        <lightning-textarea
                                            label="Description"
                                            value={formData.Description__c}
                                            onchange={handleFieldChange}
                                            data-field="Description__c"
                                            rows="3"
                                            placeholder="Describe your proficiency and projects..."
                                            field-level-help="Details about your skill level and experience"
                                        ></lightning-textarea>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Error Message -->
                        <template if:true={errorMessage}>
                            <div class="slds-m-top_medium">
                                <div class="slds-notify slds-notify_alert slds-theme_error" role="alert" style="animation: slideIn 0.3s ease-out;">
                                    <span class="slds-assistive-text">error</span>
                                    <lightning-icon icon-name="utility:error" size="x-small" variant="error" class="slds-m-right_x-small"></lightning-icon>
                                    <h2>{errorMessage}</h2>
                                </div>
                            </div>
                        </template>
                    </template>
                </div>

                <!-- Modal Footer -->
                <footer class="slds-modal__footer slds-theme_shade">
                    <lightning-button
                        label="Cancel"
                        onclick={handleClose}
                        disabled={isLoading}
                        class="slds-m-right_x-small"
                    ></lightning-button>
                    <lightning-button
                        label={saveButtonLabel}
                        variant="brand"
                        onclick={handleSave}
                        disabled={isLoading}
                        icon-name="utility:save"
                    ></lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" style="animation: fadeIn 0.3s ease-out;"></div>
    </template>
</template>